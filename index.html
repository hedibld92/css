<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi - Interstitiel classique - Statique</title>
</head>
<body>
    <!-- Structure HTML de l'interstitiel -->
    <div id="dfp_interstitial">
        <div id="dfp_interstitial__top">
            <div id="dfp_interstitial__top-logo"></div>
            <div id="dfp_interstitial__top-close">
                accéder au site &nbsp;<span class="dfp_interstitial__arrow-right"></span><span class="dfp_interstitial__arrow-right"></span>
            </div>
        </div>
        <div id="dfp_interstitial__content" class="dfp_interstitial__content">
            <div class="dfp_interstitial__click" id="dfp_interstitial__click-1" target="_blank"></div>
            <div class="dfp_interstitial__click" id="dfp_interstitial__click-2" target="_blank"></div>
        </div>
        <div id="dfp_interstitial__tracking"></div>
    </div>

    <!-- JavaScript de l'interstitiel -->
    <script>
        let clickThroughUrl = '[%ClickthroughURL%]' === '' ? '' : '%%CLICK_URL_ESC%%' + encodeURIComponent('[%ClickthroughURL%]'),
            clickThroughUrl2 = '[%ClickthroughURL2%]' === '' ? '' : '%%CLICK_URL_ESC%%' + encodeURIComponent('[%ClickthroughURL2%]'),
            interstitial = document.getElementById('dfp_interstitial'),
            interstitialCloseButton = document.getElementById('dfp_interstitial__top-close'),
            interContent = document.getElementById('dfp_interstitial__content'),
            interstitialTracking = document.getElementById('dfp_interstitial__tracking'),
            topBodyOverflow,
            windowInnerWidth;

        // Variables pour les sites spécifiques
        var interstitialSite = top.document.querySelector('#dfp_interstitial');
        var hostname = top.window.location.hostname;
        var dalilymotionPlayer = top.document.querySelector(".dailymotion-player-wrapper");

        function removeZIndex() {
            const adSlot = document.getElementById('ogy-ad-slot');
            if (adSlot) {
                adSlot.style.zIndex = '';
                console.log('z-index removed from #ogy-ad-slot');
            } else {
                console.log('Element #ogy-ad-slot not found');
            }
        }

        // Désactiver le z-index
        removeZIndex();

        (function init() {
            // Attendre que le DOM soit complètement chargé
            setTimeout(() => {
                preventScroll();

                // Fonction pour gérer swg-dialog et swg-popup-background
            function handleSwgElements() {
                try {
                    const dialog = top.document.querySelector('.swg-dialog');
                    if (dialog) {
                        dialog.style.setProperty('z-index', '10000000', 'important');
                    }

                    const popupBg = top.document.querySelector('swg-popup-background');
                    if (popupBg) {
                        popupBg.style.setProperty('z-index', '1000000', 'important');
                    }
                } catch (e) {}
            }

            // Observer pour détecter l'apparition de swg-dialog
            try {
                const observer = new MutationObserver((mutations) => {
                    for (const mutation of mutations) {
                        if (mutation.addedNodes.length) {
                            handleSwgElements();
                        }
                    }
                });

                observer.observe(top.document.body, {
                    childList: true,
                    subtree: true
                });
            } catch (e) {}

            // Exécution immédiate
            handleSwgElements();

            // Vérification périodique de backup
            const checkInterval = setInterval(handleSwgElements, 50);

            // Manual close
            interstitialCloseButton.addEventListener('click', ()=> {
                interstitialClose();
            });

            // Autoclose
            if (!top.window.location.hash.includes('#jad_preview')) {
                setTimeout(interstitialClose, [%CloseDelay%]*1000);
            }

            if (clickThroughUrl) {
                if(clickThroughUrl2){
                    document.querySelector('#dfp_interstitial__click-1').addEventListener('click', function () {
                        top.window.open(clickThroughUrl);

                        // Event Tracking - URL 1
                        var trackingUrl1 = createTracking('https://pubads.g.doubleclick.net/activity;xsp=5301650;ord=');
                        interstitialTracking.appendChild(trackingUrl1);

                        // Log interaction tracking
                        console.log("click 1");
                        logAction("Click on redirection URL 1");
                    });
                    document.querySelector('#dfp_interstitial__click-2').addEventListener('click', function () {
                        top.window.open(clickThroughUrl2);

                        //Event Tracking - URL 2
                        var trackingUrl2 = createTracking('https://pubads.g.doubleclick.net/activity;xsp=5301653;ord=');
                        interstitialTracking.appendChild(trackingUrl2);

                        // Log interaction tracking
                        console.log("click 2");
                        logAction("Clic on redirection URL 2");
                    });
                } else {
                    document.querySelector('#dfp_interstitial__content').addEventListener('click', function () {
                        top.window.open(clickThroughUrl);

                        // Log interaction tracking
                        console.log("click 1");
                        logAction("Click on redirection URL 1");

                        //Event Tracking - URL 1
                        var trackingUrl1 = createTracking('https://pubads.g.doubleclick.net/activity;xsp=5301650;ord=');
                        interstitialTracking.appendChild(trackingUrl1);
                    });
                }
            }

            // Move the frame out of the flow
            frameElement.style.position = "fixed";
            frameElement.style.top = 0;
            frameElement.style.left = 0;
            frameElement.style.zIndex = 1999999987;
            frameElement.style.height = "100%";
            frameElement.style.width = "100%";

            // Hide dailymotion player
            if(dalilymotionPlayer){
                dalilymotionPlayer.style.display = "none";
            }

            // Interstitiel header logo
            setHeaderLogo();

            // for jeuxvideo.com
            if (hostname.includes("jeuxvideo")) {
                interstitialSite.style.cssText += "pointer-events: visible;";
            }
            }, 500); // Délai pour que le DOM soit prêt
        })();

        function preventScroll() {
            // Retrieves and stores initial body position;
            topBodyOverflow = top.document.body.style.overflow;

            // Hide Scrollbar for ozap
            if (hostname.includes("ozap")) {
                const styleElem = top.document.body.appendChild(document.createElement("style"));

                styleElem.setAttribute('id', 'dfp_style_hide-scrollbar');
                styleElem.innerHTML = " ";

                styleElem.innerHTML = "body::-webkit-scrollbar {display: none;}" +
                    "html {scrollbar-width: none;}" +
                    "body {-ms-overflow-style: none;}";
            }

            // Prevents scrolling
            top.document.body.style.overflow = "hidden";
            top.document.body.style.position = "fixed";
        }

        function setHeaderLogo() {
            var logoURL = "",
                hostname = top.window.location.hostname;
            if (hostname.includes("allocine.fr")){
                logoURL = top.document.querySelector(".header-main-logo-img").src;
            }
            if (hostname.includes("cgrcinemas.fr") || hostname.includes("demo-cgr")) logoURL = "https://www.cgrcinemas.fr/image/2017/logo.png";
            if (hostname.includes("grandecran.fr")) logoURL = "https://www.grandecran.fr/image/2017/logo_portail.png";
            if (hostname.includes("purebreak")) logoURL = "https://yt3.ggpht.com/a-/AAuE7mBlVHWfnojQqdsck7ZO9gopI-UYbrPta1XGeg=s900-mo-c-c0xffffffff-rj-k-no";
            if (hostname.includes("jeuxvideo")) logoURL = "https://www.jeuxvideo.com/favicon.png";
            if (hostname.includes("millenium")) logoURL = "https://static1-fr.millenium.gg/skin/logo-mgg-interstitiel.png";
            if (hostname.includes("boxoffice")) logoURL = "https://www.boxofficepro.fr/wp-content/uploads/sites/2/2019/01/logo-2.svg";
            if (logoURL) {
                setTimeout(()=> {
                    document.getElementById('dfp_interstitial__top-logo').style.backgroundImage = 'url("'+logoURL+'")';
                }, 1000);
            }
        }

        function interstitialClose() {
            top.document.body.style.overflow = topBodyOverflow;
            const interstitialElement = document.getElementById('dfp_interstitial');
            if (interstitialElement && interstitialElement.parentNode) {
                interstitialElement.parentNode.removeChild(interstitialElement);
            }

            frameElement.style.display = "none";
            top.document.body.style.overflow = "";
            top.document.body.style.position = "";

            if (hostname.includes("ozap")) {
                document.getElementById("dfp_style_hide-scrollbar").remove();
            }

            if(dalilymotionPlayer){
                dalilymotionPlayer.style.display = "block";
            }
            

            //Event Tracking - close-button
            var trackingCloseButton = createTracking('https://pubads.g.doubleclick.net/activity;xsp=5151585;ord=');
            interstitialTracking.appendChild(trackingCloseButton);

            // Log interaction tracking
            console.log("click close");
            logAction("Click on close");
        }

        // Interaction tracking
        function logAction(eventNameStr) {
            top.postMessage(
                {
                    jadMessage: "logAction",
                    positionKey: "%%PATTERN:position%%/%%PATTERN:jad_divId%%",
                    eventName: eventNameStr,
                }
                , "*");
        }

        // Create eventtracking img
        function createTracking(src){
            const trackingImg = top.document.createElement('img');
            trackingImg.setAttribute('width', 1);
            trackingImg.setAttribute('height', 1);
            trackingImg.setAttribute('border', 0);
            var a = String(Math.floor(Math.random() * 10000000000000000));
            trackingImg.setAttribute('src', src + a +'?');

            return trackingImg;
        }
    </script>

    <!-- Variables GAM additionnelles -->
    [%AdditionalScripts%]
</body>
</html> 